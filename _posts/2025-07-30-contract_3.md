---
title: MultiSig-gnosis
author: Tao He
date: 2025-07-24
category: Jekyll
layout: post
---

- 이 섹션에서는 실험을 통해 얻은 내용들을 서술한다.

MultiSig-gnosis 분석
-------------

![img]({{ site.baseurl }}/assets/multisig_1.png){: style="width:500px;","display: block; margin: 0;" }

Owner 는 MultiSigWalletFactory 컨트랙트를 통해서 지갑을 만들수있다. 

create()시 MultiSigWallet의 소유자의 소유자를 등록할수있고, 트랜잭션을 실행하기위한 최소 동의수, Required 입력받는다. 

MultiSigWallet 컨트랙트에서는 초기에 등록된 Owner를 추가 수정 제거(CRUD) 가능하다. 

- OnlyWallet() 이라는 조건을 가지고있기에 MultiSigWallet이 실행시켜야 가능하다.
- 즉, 서명기반 트랜잭션으로 실행이 가능한 기능

SubmitTransaction을 통해서 실행할 트랜잭션의 주소와 파라미터 데이터를 입력받을수있다. 

confimTransaction()는 SubmitTransaction을 통해서 생성된 Id를 매개변수로 받아 트랜잭션 실행에 대해 “comfirm” 할수있다. 이와 동시에 Required가 과반수를 넘으면 트랜잭션을 실행한다. 

owner는 executeTransaction() 통해서 트랜잭션을 실행할수있다.

-------------

## Factory 컨트랙트

### 함수 설명

1. **getInstantiationCount(address creator)**
    - **설명**: 주어진 생성자가 만든 지갑 인스턴스의 개수를 반환합니다.
    - **매개변수**:
        - `creator`: 지갑을 만든 계정의 주소.
    - **반환값**: 생성자가 만든 지갑 인스턴스의 개수 (uint 형식).
2. **register(address instantiation)**
    - **설명**: 팩토리 레지스트리에 지갑 인스턴스를 등록합니다.
    - **매개변수**:
        - `instantiation`: 생성된 지갑의 주소.
    - **작동 방식**:
        - 지갑 주소의 상태를 `true`로 설정하고, 지갑을 만든 사용자의 주소에 생성된 지갑 주소를 추가합니다.
        - `ContractInstantiation` 이벤트를 트리거합니다.


-------------

## MultiSigWallet 컨트랙트

### 함수 설명

1. **MultiSigWallet(address[] _owners, uint _required)**
    - **설명**: 컨트랙트 생성자로서 초기 오너들과 필요한 동의 개수를 설정합니다.
    - **매개변수**:
        - `_owners`: 초기 오너들의 주소 리스트.
        - `_required`: 필요한 동의의 개수.
2. **addOwner(address owner)**
    - **설명**: 새로운 오너를 추가합니다. 이 트랜잭션은 지갑에 의해 보내져야 합니다.
    - **매개변수**:
        - `owner`: 새 오너의 주소.
    - **조건**:
        - 추가되는 오너의 주소는 0이 아니어야 하고 기존 오너가 아니어야 합니다.
        - 새로운 오너를 추가할 수 있는 조건이 만족되어야 합니다.
3. **removeOwner(address owner)**
    - **설명**: 기존의 오너를 제거합니다. 이 트랜잭션은 지갑에 의해 보내져야 합니다.
    - **매개변수**:
        - `owner`: 제거할 오너의 주소.
    - **조건**:
        - 제거되는 오너는 기존의 오너여야 합니다.
4. **replaceOwner(address owner, address newOwner)**
    - **설명**: 기존의 오너를 새로운 오너로 교체합니다. 이 트랜잭션은 지갑에 의해 보내져야 합니다.
    - **매개변수**:
        - `owner`: 교체될 오너의 주소.
        - `newOwner`: 새로운 오너의 주소.
    - **조건**:
        - 교체될 오너는 기존의 오너여야 하며, 새로운 오너는 아직 등록되지 않은 주소여야 합니다.
5. **changeRequirement(uint _required)**
    - **설명**: 필요한 동의 개수를 변경합니다. 이 트랜잭션은 지갑에 의해 보내져야 합니다.
    - **매개변수**:
        - `_required`: 새로운 필요한 동의의 개수.
6. **submitTransaction(address destination, uint value, bytes data)**
    - **설명**: 오너가 트랜잭션을 제출하고 동의할 수 있습니다.
    - **매개변수**:
        - `destination`: 트랜잭션 대상 주소.
        - `value`: 트랜잭션 이더 값.
        - `data`: 트랜잭션 데이터 페이로드.
7. **confirmTransaction(uint transactionId)**
    - **설명**: 오너가 트랜잭션을 동의할 수 있게 합니다.
    - **매개변수**:
        - `transactionId`: 트랜잭션 ID.
8. **revokeConfirmation(uint transactionId)**
    - **설명**: 오너가 트랜잭션에 대한 동의를 철회할 수 있게 합니다.
    - **매개변수**:
        - `transactionId`: 트랜잭션 ID.
9. **executeTransaction(uint transactionId)**
    - **설명**: 확인된 트랜잭션을 실행할 수 있습니다.
    - **매개변수**:
        - `transactionId`: 트랜잭션 ID.
10. **isConfirmed(uint transactionId)**
    - **설명**: 트랜잭션의 동의 상태를 반환합니다.
    - **매개변수**:
        - `transactionId`: 트랜잭션 ID.
    - **반환값**: 트랜잭션의 동의 상태 (bool 형식).
11. **addTransaction(address destination, uint value, bytes data)**
    - **설명**: 새 트랜잭션을 트랜잭션 매핑에 추가합니다.
    - **매개변수**:
        - `destination`: 트랜잭션 대상 주소.
        - `value`: 트랜잭션 이더 값.
        - `data`: 트랜잭션 데이터 페이로드.
    - **반환값**: 트랜잭션 ID.
12. **getConfirmationCount(uint transactionId)**
    - **설명**: 트랜잭션에 대한 동의 개수를 반환합니다.
    - **매개변수**:
        - `transactionId`: 트랜잭션 ID.
    - **반환값**: 동의 개수 (uint 형식).
13. **getTransactionCount(bool pending, bool executed)**
    - **설명**: 필터가 적용된 후 트랜잭션의 총 개수를 반환합니다.
    - **매개변수**:
        - `pending`: 대기 중인 트랜잭션 포함 여부.
        - `executed`: 실행된 트랜잭션 포함 여부.
    - **반환값**: 필터가 적용된 후의 트랜잭션 총 개수 (uint 형식).
14. **getOwners()**
    - **설명**: 오너들의 목록을 반환합니다.
    - **반환값**: 오너들의 주소 리스트 (address[] 형식).
15. **getConfirmations(uint transactionId)**
    - **설명**: 트랜잭션을 확인한 오너들의 주소 배열을 반환합니다.
    - **매개변수**:
        - `transactionId`: 트랜잭션 ID.
    - **반환값**: 오너들의 주소 배열 (address[] 형식).
16. **getTransactionIds(uint from, uint to, bool pending, bool executed)**
    - **설명**: 정의된 범위 내의 트랜잭션 ID 목록을 반환합니다.
    - **매개변수**:
        - `from`: 트랜잭션 배열의 시작 인덱스.
        - `to`: 트랜잭션 배열의 끝 인덱스.
        - `pending`: 대기 중인 트랜잭션 포함 여부.
        - `executed`: 실행된 트랜잭션 포함 여부.
    - **반환값**: 트랜잭션 ID 배열 (uint[] 형식).

-------------

## MultiSigWalletFactory 컨트랙트

### 함수 설명

1. **create(address[] _owners, uint _required)**
    - **설명**: 멀티서명 지갑을 생성할 수 있게 합니다.
    - **매개변수**:
        - `_owners`: 초기 오너들의 주소 리스트.
        - `_required`: 필요한 동의의 개수.
    - **반환값**: 생성된 지갑의 주소.